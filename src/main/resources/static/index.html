<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Site</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Welcome to Our E-Commerce Store</h1>

<!-- Product Details -->
<div class="product">
    <h2>Product Name</h2>
    <p>Description: Indepandence Day offer !! flat 30% discount on selected item.</p>
    <div id="product-list" class="products">
    </div>
</div>

<!-- Cart -->
<div class="cart">
    <h2>Cart</h2>
    <ul id="cart-items">
        <!-- Cart items will be added here dynamically -->
    </ul>
    <button onclick="placeOrder()">Place Order</button>
</div>

<!-- Order Tracking -->
<div class="order-tracking">
    <h2>Order Tracking</h2>
    <input type="text" id="order-number" placeholder="Enter Order Number">
    <button onclick="trackOrder()">Track Order</button>
    <p id="order-status"></p>
</div>

<script>
   document.addEventListener("DOMContentLoaded", function () {
            var productList = document.getElementById("product-list");

            fetchProducts();

            function fetchProducts() {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "http://localhost:8080/api/product/all", true);

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var products = JSON.parse(xhr.responseText);

                        products.forEach(function (product) {
                            var productItem = document.createElement("div");
                            productItem.classList.add("product-item");

                            var productName = document.createElement("h2");
                            productName.textContent = product.productName;

                            var productDescription = document.createElement("p");
                            productDescription.textContent = product.productSpec;

                            var productPrice = document.createElement("p");
                            productPrice.textContent = "Price: $" + product.price;

                            var addToCartButton = document.createElement("button");
                            addToCartButton.textContent = "Add to Cart";
                            addToCartButton.addEventListener("click", function() {
                                // Call the existing addToCart function and pass the product name
                                addToCart(product); // Replace "Product Name" with the actual product name
                            });
                            //addToCartButton.addEventListener("click", "addToCart()");
                            //addToCartButton.addEventListener("click", "addToCart");
                        


                            productItem.appendChild(productName);
                            productItem.appendChild(productDescription);
                            productItem.appendChild(productPrice);
                            productItem.appendChild(addToCartButton);
                            productList.appendChild(productItem);
                        });
                    } else if (xhr.readyState === 4) {
                        console.error("Error fetching products:", xhr.statusText);
                    }
                };

                xhr.send();
            }
        });
        // Array to store cart items
        let cartItems = [];

        // Function to add an item to the cart
        function  addToCart(product) {
            if(product!==null){
             cartItems.push(product.productName);
            }
            updateCart();
        }

        // Function to update the cart display
        function updateCart() {
            const cartList = document.getElementById("cart-items");
            cartList.innerHTML = "";
            cartItems.forEach(item => {
                const li = document.createElement("li");
                li.textContent = item;
                cartList.appendChild(li);
            });
        }

        // Function to place an order
        function placeOrder() {
            if (cartItems.length > 0) {
                const orderNumber = Math.floor(Math.random() * 1000000);
                alert(`Order placed! Your order number is: ${orderNumber}`);
                cartItems = [];
                updateCart();
            } else {
                alert("Your cart is empty. Add items before placing an order.");
            }
        }

        // Function to track an order
        function trackOrder() {
            const orderNumberInput = document.getElementById("order-number");
            const orderNumber = parseInt(orderNumberInput.value);
            const orderStatus = document.getElementById("order-status");

            // Simulated order tracking logic
            if (orderNumber) {
                const randomStatus = Math.random() > 0.5 ? "Shipped" : "Processing";
                orderStatus.textContent = `Order ${orderNumber} status: ${randomStatus}`;
            } else {
                orderStatus.textContent = "Please enter a valid order number.";
            }
        }
    </script>
</body>
</html>
